# ๐งน ะะพะผะฐัะฝะตะต ะทะฐะดะฐะฝะธะต โ5 โ ะะฐะปะธะดะฐัะธั ัะบะพะฑะพะบ ะธ ะฑะฐะปะฐะฝัะธัะพะฒะบะฐ ะฝะฐะณััะทะบะธ

## ๐ฆ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะฃัะตะฑะฝัะน ะฟัะพะตะบั ะดะปั ะพััะฐะฑะพัะบะธ ะฟัะฐะบัะธัะตัะบะธั ะฝะฐะฒัะบะพะฒ ะฒ ัะฐะฑะพัะต ั Docker, PHP-FPM, Nginx, Redis ะธ ััะพะฝัะตะฝะดะพะผ ะฝะฐ Vue.js.
ะัะฝะพะฒะฝะฐั ะทะฐะดะฐัะฐ โ ัะตะฐะปะธะทะพะฒะฐัั ะฒะตะฑ-ัะตัะฒะธั, ะฟัะธะฝะธะผะฐััะธะน ัััะพะบั ะธะท ัะบะพะฑะพะบ ัะตัะตะท POST-ะทะฐะฟัะพั, ะฟัะพะฒะตััััะธะน ะตั ะบะพััะตะบัะฝะพััั ั ัะพัะบะธ ะทัะตะฝะธั ะฒะปะพะถะตะฝะฝะพััะธ ะธ ัะธะผะผะตััะธะธ, ะฐ ัะฐะบะถะต ะพัะณะฐะฝะธะทะพะฒะฐัั ะฑะฐะปะฐะฝัะธัะพะฒะบั ะฝะฐะณััะทะบะธ ะผะตะถะดั ะฝะตัะบะพะปัะบะธะผะธ backend-ะบะพะฝัะตะนะฝะตัะฐะผะธ.

ะัะพะตะบั ะฟะพัััะพะตะฝ ะฝะฐ ะผะธะบัะพัะตัะฒะธัะฝะพะน ะฐััะธัะตะบัััะต ั ัะฐะทะดะตะปะตะฝะธะตะผ ะฝะฐ:

โ ะฑะฐะปะฐะฝัะธัะพะฒัะธะบ (nginx upstream)
โ ะดะฒะฐ backend-ะฐ (nginx + php-fpm)
โ Redis-ััะฐะฝะธะปะธัะต ะดะปั ัะตััะธะน
โ frontend-ะฟัะธะปะพะถะตะฝะธะต (Vue + Vite), ะฟัะตะดะพััะฐะฒะปัััะตะต ะฒะตะฑ-ัะพัะผั ะดะปั ะฟัะพะฒะตัะบะธ

## ๐งฑ ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

* PHP 8.3 (FPM)
* Nginx (ะฑะฐะปะฐะฝัะธัะพะฒัะธะบ ะธ backend)
* Redis
* Docker / Docker Compose
* Composer (PSR-4 autoload)
* Vue 3 + Vite

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
otus-php-hw04/
โโโ balancer/
โ   โโโ nginx.conf
โโโ docker/
โ   โโโ balancer/
โ   โ   โโโ balancer.Dockerfile
โ   โโโ frontend/
โ   โ   โโโ vue.dev.Dockerfile
โ   โ   โโโ vue.prod.Dockerfile
โ   โ   โโโ nginx.conf
โ   โโโ nginx/
โ   โ   โโโ nginx.Dockerfile
โ   โโโ php/
โ       โโโ php.Dockerfile
โ       โโโ php.ini
โ       โโโ php-fpm.conf
โ       โโโ conf.d/
โ       โ   โโโ session.redis.ini
โ       โโโ www-fpm1.conf
โ       โโโ www-fpm2.conf
โโโ frontend/
โ   โโโ src/
โ   โ   โโโ utils/
โ   โ   โ   โโโ bracketGenerator.js
โ   โ   โโโ App.vue
โ   โ   โโโ main.js
โ   โโโ index.html
โ   โโโ vite.config.js
โ   โโโ package.json
โโโ public/
โ   โโโ index.php
โโโ src/
โ   โโโ Validator.php
โโโ vendor/
โโโ .gitignore
โโโ composer.json
โโโ docker-compose.yml
โโโ docker-compose.dev.yml
โโโ docker-compose.prod.yml
โโโ Makefile
โโโ README.md
```

## โ๏ธ ะะฐะบ ะทะฐะฟัััะธัั ะฟัะพะตะบั

### Dev-ัะตะถะธะผ (ัะฑะพัะบะฐ ะธ ะทะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ ั ะธััะพะดะฝะธะบะฐะผะธ)

```bash
make dev-build    # ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ
make dev-down     # ะััะฐะฝะพะฒะบะฐ dev-ะพะบััะถะตะฝะธั
```

### Prod-ัะตะถะธะผ (ัะฑะพัะบะฐ ะธ ะทะฐะฟััะบ production-ะพะฑัะฐะทะพะฒ)

```bash
make prod-up      # ะะพะดััะฝััั ะธ ะทะฐะฟัััะธัั production-ะพะฑัะฐะทั
make prod-down    # ะััะฐะฝะพะฒะบะฐ prod-ะพะบััะถะตะฝะธั
```

### ะะพะปะฝัะน ัะฟะธัะพะบ ะบะพะผะฐะฝะด ะฒ Makefile

* `make dev-up` โ ะฟะพะดะฝััั dev-ะพะบััะถะตะฝะธะต
* `make dev-down` โ ะพััะฐะฝะพะฒะธัั dev-ะพะบััะถะตะฝะธะต
* `make dev-build` โ ัะพะฑัะฐัั ะธ ะทะฐะฟัััะธัั dev-ะพะบััะถะตะฝะธะต ั dev-ะทะฐะฒะธัะธะผะพัััะผะธ
* `make dev-rebuild` โ ะฟะตัะตัะพะฑัะฐัั dev-ะพะบััะถะตะฝะธะต ะฑะตะท ะบะตัะฐ
* `make dev-logs` โ ะฟะพะบะฐะทะฐัั dev-ะปะพะณะธ
* `make prod-up` โ ะฟะพะดััะฝััั ะพะฑัะฐะทั ะธ ะทะฐะฟัััะธัั prod-ะพะบััะถะตะฝะธะต
* `make prod-down` โ ะพััะฐะฝะพะฒะธัั prod-ะพะบััะถะตะฝะธะต
* `make prod-build-local` โ ะปะพะบะฐะปัะฝะพ ัะพะฑัะฐัั prod-ะพะฑัะฐะทั
* `make prod-push` โ ะทะฐะฟััะธัั prod-ะพะฑัะฐะทั ะฒ Docker Hub
* `make prod-logs` โ ะฟะพะบะฐะทะฐัั prod-ะปะพะณะธ
* `make ps` โ ะฟะพะบะฐะทะฐัั ะทะฐะฟััะตะฝะฝัะต ะบะพะฝัะตะนะฝะตัั

## ๐งช ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

ะัั ัะตััะธััะตััั **ัะตัะตะท ะฒะตะฑ-ะธะฝัะตััะตะนั**, ัะดะตะปะฐะฝะฝัะน ะฝะฐ Vue.
ะะฝ ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั [http://localhost](http://localhost), ะณะดะต ะพัะพะฑัะฐะถะฐะตััั ัะพัะผะฐ:
๐ธ ะฒะฒะตะดะธัะต ัััะพะบั ะธะท ัะบะพะฑะพะบ (ะธะปะธ ัะณะตะฝะตัะธััะนัะต ะฟัะธะผะตั)
๐ธ ะพัะฟัะฐะฒััะต ะฝะฐ ะฟัะพะฒะตัะบั
๐ธ ะฟะพะปััะธัะต ัะตะทัะปััะฐั ะฟััะผะพ ะฒ ะฑัะฐัะทะตัะต.

## ๐ ะะฐะปะธะดะฐัะธั ัััะพะบะธ

ะะฐะปะธะดะฐัะธั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะฒ `src/Validator.php` ะธ ััะธััะฒะฐะตั:

* ะฟััััะต ัััะพะบะธ โ ะพัะธะฑะบะฐ
* ะบะพััะตะบัะฝะพััั ะฒะปะพะถะตะฝะฝะพััะธ `(` ะธ `)`
* ะทะฐะฟัะตั ะปัะฑัั ะดััะณะธั ัะธะผะฒะพะปะพะฒ

ะะตะทัะปััะฐั ะพะฑัะฐะฑะพัะบะธ:

* โ 200 OK, ะตัะปะธ ัััะพะบะฐ ะฒะฐะปะธะดะฝะฐ
* โ 400 Bad Request, ะตัะปะธ ัััะพะบะฐ ะฝะตะบะพััะตะบัะฝะฐ

## ๐ ะััะธัะตะบัััะฐ Nginx

ะะฐะปะฐะฝัะธัะพะฒัะธะบ (ะฑะฐะปะฐะฝัะธััะตั ะฟะพ backend):

```nginx
upstream backend_upstream {
    server nginx-backend1:80;
    server nginx-backend2:80;
}

location /api/ {
    proxy_pass http://backend_upstream/;
    ...
}
```

Backend-ัะตัะฒะธัั (nginx + php-fpm ัะตัะตะท ัะพะบะตั).

## ๐ก๏ธ ะกะตััะธะธ ะธ Redis

ะกะตััะธะธ PHP ัะพััะฐะฝััััั ะฒ Redis ั ะฟะพะผะพััั ะฝะฐัััะพะตะบ:

```
session.save_handler = redis
session.save_path = "tcp://redis-node1:6379?prefix=otus_hw04:"
```

## โ ะัะฟะพะปะฝะตะฝะฝัะต ััะตะฑะพะฒะฐะฝะธั

* [x] Docker-ะบะพะฝัะตะนะฝะตัั: nginx, php-fpm, redis
* [x] POST-ะทะฐะฟัะพั `/api/validate`
* [x] ะะพััะตะบัะฝะฐั ะฒะฐะปะธะดะฐัะธั ะฒะปะพะถะตะฝะฝัั ัะบะพะฑะพะบ
* [x] ะะฐะปะฐะฝัะธัะพะฒะบะฐ ะผะตะถะดั backend-ะฐะผะธ ัะตัะตะท nginx upstream
* [x] Redis-ัะตััะธะธ
* [x] ะะฐะทะดะตะปะตะฝะธะต dev ะธ prod ะพะบััะถะตะฝะธะน
* [x] Frontend-ะธะฝัะตััะตะนั ะฝะฐ Vue

---

## ๐ฎ ะะฒัะพั

**Vladimir Matkovskii** โ [vlavlamat@icloud.com](mailto:vlavlamat@icloud.com)
