# ๐งน ะะพะผะฐัะฝะตะต ะทะฐะดะฐะฝะธะต โ5 โ ะะฐะปะธะดะฐัะธั ัะบะพะฑะพะบ ะธ ะฑะฐะปะฐะฝัะธัะพะฒะบะฐ ะฝะฐะณััะทะบะธ

## ๐ฆ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะฃัะตะฑะฝัะน ะฟัะพะตะบั ะดะปั ะพััะฐะฑะพัะบะธ ะฟัะฐะบัะธัะตัะบะธั ะฝะฐะฒัะบะพะฒ ะฒ ัะฐะฑะพัะต ั Docker, PHP-FPM, Nginx, Redis ะธ ััะพะฝัะตะฝะดะพะผ ะฝะฐ Vue.js. ะัะฝะพะฒะฝะฐั ะทะฐะดะฐัะฐ โ ัะตะฐะปะธะทะพะฒะฐัั ะฒะตะฑ-ัะตัะฒะธั, ะฟัะธะฝะธะผะฐััะธะน ัััะพะบั ะธะท ัะบะพะฑะพะบ ัะตัะตะท POST-ะทะฐะฟัะพั, ะฟัะพะฒะตััััะธะน ะตั ะบะพััะตะบัะฝะพััั ั ัะพัะบะธ ะทัะตะฝะธั ะฒะปะพะถะตะฝะฝะพััะธ ะธ ัะธะผะผะตััะธะธ, ะฐ ัะฐะบะถะต ะพัะณะฐะฝะธะทะพะฒะฐัั ะฑะฐะปะฐะฝัะธัะพะฒะบั ะฝะฐะณััะทะบะธ ะผะตะถะดั ะฝะตัะบะพะปัะบะธะผะธ backend-ะบะพะฝัะตะนะฝะตัะฐะผะธ.

ะัะพะตะบั ะฟะพัััะพะตะฝ ะฝะฐ ะผะธะบัะพัะตัะฒะธัะฝะพะน ะฐััะธัะตะบัััะต ั ัะฐะทะดะตะปะตะฝะธะตะผ ะฝะฐ:

* ะฑะฐะปะฐะฝัะธัะพะฒัะธะบ (nginx upstream)
* ะดะฒะฐ backend-ะฐ (nginx + php-fpm)
* redis-ััะฐะฝะธะปะธัะต ะดะปั ัะตััะธะน
* ััะพะฝัะตะฝะด-ะฟัะธะปะพะถะตะฝะธะต (Vue + Vite)

## ๐งฑ ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

* PHP 8.3 (FPM)
* Nginx (ััะฐัะธัะฝัะน ัะตัะฒะตั ะธ ะฑะฐะปะฐะฝัะธัะพะฒัะธะบ)
* Redis
* Docker / Docker Compose
* Composer (PSR-4 autoload)
* Vue 3 + Vite

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
otus-php-hw04/
โโโ balancer/                      # ะะพะฝัะธะณััะฐัะธั ะฑะฐะปะฐะฝัะธัะพะฒัะธะบะฐ
โ   โโโ nginx.conf
โโโ docker/                        # Dockerfile'ั ะธ ะบะพะฝัะธะณะธ
โ   โโโ balancer/
โ   โ   โโโ balancer.Dockerfile
โ   โโโ nginx/
โ   โ   โโโ nginx.Dockerfile
โ   โ   โโโ conf.d/
โ   โ       โโโ default.conf
โ   โโโ php/
โ       โโโ php.Dockerfile
โ       โโโ php.ini
โ       โโโ conf.d/
โ       โ   โโโ session.redis.ini
โ       โโโ www-fpm1.conf
โ       โโโ www-fpm2.conf
โโโ frontend/                      # Vue frontend
โ   โโโ src/
โ   โ   โโโ assets/
โ   โ   โโโ utils/bracketGenerator.js
โ   โโโ App.vue
โ   โโโ main.js
โ   โโโ index.html
โ   โโโ package.json
โ   โโโ vite.config.js
โโโ nginx/                         # ะกัะฐัะธัะฝัะต nginx-ะบะพะฝัะธะณะธ backend
โ   โโโ nginx.conf
โ   โโโ conf.d/
โ       โโโ default.conf
โโโ public/                        # ะะตะฑ-ะดะพัััะฟะฝัะน PHP
โ   โโโ index.php
โโโ src/                           # PHP-ะบะปะฐััั (ะฐะฒัะพะทะฐะณััะทะบะฐ)
โ   โโโ Validator.php
โโโ vendor/                        # Composer ะทะฐะฒะธัะธะผะพััะธ
โโโ .gitignore
โโโ composer.json
โโโ docker-compose.yml
โโโ docker-compose.dev.yml
โโโ docker-compose.prod.yml
โโโ Makefile
โโโ README.md
```

## โ๏ธ ะะฐะบ ะทะฐะฟัััะธัั (dev-ัะตะถะธะผ)

```bash
# ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
make dev-build

# ะััะฐะฝะพะฒะบะฐ
make stop
```

ะะปััะตัะฝะฐัะธะฒะฝะพ ะฝะฐะฟััะผัั:

```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up --build -d
```

## ๐จ ะัะธะผะตั ะทะฐะฟัะพัะฐ (CLI)

```bash
# ะะพััะตะบัะฝะฐั ัััะพะบะฐ
curl -X POST http://localhost/api/validate -d "string=(()())"

# ะะตะบะพััะตะบัะฝะฐั ัััะพะบะฐ
curl -X POST http://localhost/api/validate -d "string=)(()"
```

## ๐ ะะฐะปะธะดะฐัะธั ัััะพะบะธ

ะะฐะปะธะดะฐัะธั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะฒ `src/Validator.php` ะธ ััะธััะฒะฐะตั:

* ะฟััััะต ัััะพะบะธ (ะพัะธะฑะบะฐ)
* ะฒะปะพะถะตะฝะฝะพััั ะธ ะฟัะฐะฒะธะปัะฝัั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั `()`
* ะทะฐะฟัะตั ะปัะฑัั ัะธะผะฒะพะปะพะฒ ะบัะพะผะต `(` ะธ `)`

### ะัะธะผะตั ะบะพะดะฐ:

```php
Validator::validate('(()())'); // true
Validator::validate('((())');  // false
Validator::validate(')(');     // false
```

## ๐ง ะะฐะถะฝัะต ัะฐะนะปั ะธ ะธั ะฝะฐะทะฝะฐัะตะฝะธะต

### PHP:

* `php.ini` โ ะฑะฐะทะพะฒะฐั ะฝะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั
* `session.redis.ini` โ ะฝะฐัััะพะนะบะฐ ััะฐะฝะตะฝะธั ัะตััะธะน ะฒ Redis
* `www-fpm1.conf`, `www-fpm2.conf` โ ะบะพะฝัะธะณะธ php-fpm ะดะปั ัะฐะทะฝัั ะธะฝััะฐะฝัะพะฒ

### Nginx-ะฑะฐะปะฐะฝัะธัะพะฒัะธะบ:

```nginx
upstream backend_upstream {
    server nginx-backend1:80;
    server nginx-backend2:80;
}

location /api/ {
    proxy_pass http://backend_upstream;
    ...
}
```

### Vue frontend (ัะฟัะพััะฝะฝัะน ะทะฐะฟััะบ)

```bash
cd frontend
npm install
npm run dev
```

## ๐งช ะะตะฝะตัะฐัะธั ัะบะพะฑะพัะฝัั ัััะพะบ (frontend)

ะคัะพะฝัะตะฝะด ะธัะฟะพะปัะทัะตั ะณะตะฝะตัะฐัะพั ัััะพะบ (ะฒะฐะปะธะดะฝัั/ะฝะตะฒะฐะปะธะดะฝัั) ะธะท `bracketGenerator.js` ะธ ะฒะธะทัะฐะปะธะทะธััะตั ัะตะทัะปััะฐั ะฟัะพะฒะตัะบะธ ัะตัะตะท REST API.

---

## โ ะัะฟะพะปะฝะตะฝะฝัะต ััะตะฑะพะฒะฐะฝะธั ะทะฐะดะฐะฝะธั:

* [x] Docker-ะบะพะฝัะตะนะฝะตัั: nginx, php-fpm, redis โ
* [x] POST-ะทะฐะฟัะพั `/api/validate` โ
* [x] ะะพััะตะบัะฝะฐั ะฒะฐะปะธะดะฐัะธั ะฒะปะพะถะตะฝะฝัั ัะบะพะฑะพะบ โ
* [x] ะะฐะปะฐะฝัะธัะพะฒะบะฐ ะผะตะถะดั backend-ะฐะผะธ ัะตัะตะท nginx upstream โ
* [x] Redis-ัะตััะธะธ โ
* [x] ะะฐะทะดะตะปะตะฝะธะต dev ะธ prod ะพะบััะถะตะฝะธะน โ
* [x] ะคัะพะฝัะตะฝะด-ะธะฝัะตััะตะนั ะฝะฐ Vue โ

---

## ๐ฎ ะะฒัะพั

**Vladimir Matkovskii** โ [vlavlamat@icloud.com](mailto:vlavlamat@icloud.com)
