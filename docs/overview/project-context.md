# Project Context — Контекст продукта

Версия документа: 1.0  
Дата обновления: 2025-08-14

## 1. Миссия
Сделать простой и надёжный учебный сервис, который демонстрирует современный подход к построению веб‑приложения с балансировкой нагрузки, горизонтальным масштабированием backend, хранением сессий в Redis Cluster и минимальным frontend на Vue. Бизнес‑функция — проверка корректности последовательности скобок; инженерная ценность — отработка инфраструктурных паттернов и качественных практик на маленьком, полностью воспроизводимом проекте.

## 2. Цели продукта
- Обеспечить публичный API для проверки строк со скобками на корректность.  
- Показать работу за балансировщиком (Nginx upstream) с двумя backend‑инстансами.  
- Хранить PHP‑сессии в Redis Cluster и мониторить доступность кластера.  
- Предоставить простой Vue 3 фронтенд для взаимодействия с API.  
- Организовать reproducible окружения (dev/prod) на Docker Compose.  
- Покрыть ключевую бизнес‑логику автотестами (Unit/Integration), иметь отчёт о покрытии кода.

## 3. Аудитория
- Студенты и разработчики, изучающие PHP 8.x, Docker, Nginx и Redis на практическом примере.  
- Инженеры, которым нужен минимальный и понятный образец: прокси → backend → Redis → frontend (Vite) и тестирование.  
- Преподаватели/ревьюеры, проверяющие домашнее задание и архитектурную целостность.

## 4. Ценностные ориентиры
- Простота: минимально необходимая функциональность без избыточности.  
- Наблюдаемость и проверяемость: health‑checks, чёткие ответы API, автотесты и покрытие.  
- Повторяемость: «одна команда» для запуска dev/prod окружений.  
- Читабельность: понятная структура кода и документации.  
- Безопасные дефолты: корректная работа CORS, предсказуемые ошибки валидации.

## 5. Постановка задачи (Problem Statement)
Пользователю нужен быстрый и прозрачный способ проверить корректность скобочной последовательности через API или небольшой веб‑интерфейс. При этом система должна оставаться устойчивой при перезапусках контейнеров и горизонтальном масштабировании, корректно работать за балансировщиком и не терять сессии.

## 6. Область охвата (Scope) и не‑цели
- В Scope:  
  - POST /api/validate — валидация формата и баланса скобок.  
  - GET /api/status — доступность Redis Cluster.  
  - Vue 3 интерфейс (Vite dev server) для ручной проверки.  
  - Nginx proxy (удаление префикса /api при проксировании), два backend‑инстанса.  
  - PHP‑сессии в Redis Cluster; health‑мониторинг.  
  - Юнит- и интеграционные тесты, отчёт о покрытии.
- Не‑цели:  
  - Авторизация/аутентификация пользователей, биллинг, роли, админ‑панель.  
  - Сохранение пользовательского контента и истории проверок.  
  - Глубокая наблюдаемость (tracing/metrics) и сложный алертинг.  
  - Многоязычность фронтенда, SEO и полноценный дизайн‑система.

## 7. Текущий функционал (сводка)
- API:  
  - POST /api/validate — JSON {"string": "(()())"} → статусы: valid | invalid | empty | invalid_format; подробные 400 для ошибок запроса.  
  - GET /api/status — {"redis_cluster":"connected|disconnected"}.  
- CORS: GET/POST/OPTIONS; заголовки Content-Type, Authorization. Preflight возвращает 200.  
- Валидация:  
  - FormatValidator — трим, пустота, допустимые символы "(" ")", лимит длины (по коду — 30).  
  - BracketValidator — односканерная проверка баланса.  
  - DTO ValidationResult — статусы valid, invalid, empty, invalid_format.  
- Тесты: make test, unit/integration, coverage HTML в ./coverage.

См. README.md для подробностей и актуальных команд Makefile.

## 8. Технический стек
- Backend: PHP 8.4 (FPM), Composer (PSR‑4 автозагрузка).  
- Web‑серверы: Nginx (proxy + backend).  
- Хранилище сессий и health: Redis Cluster.  
- Frontend: Vue 3 + Vite + Axios.  
- Инфраструктура: Docker / Docker Compose.  
- Тестирование: PHPUnit, PCOV (dev).

## 9. Архитектура (high‑level)
- Proxy Nginx (порт 8001) проксирует /api к backend‑инстансам и снимает префикс /api при проксировании.  
- Два backend (Nginx + PHP‑FPM) обслуживают запросы; приложение реализовано в каталоге src/.  
- Redis Cluster хранит PHP‑сессии и используется для health‑проверок (кворум узлов).  
- Frontend (frontend/) — Vite dev‑сервер в dev, сборка в prod; общается с API через прокси.  
- Конфигурации: docker‑compose.*.yml, nginx/*, php/*, config/redis.php.

## 10. Ограничения и допущения
- Ограничение длины проверяемой строки — 30 символов (на стороне FormatValidator).  
- Допустимы только символы '(' и ')' (прочие считаются invalid_format).  
- Соединение с Redis Cluster считается «поднятым» при достижении кворума доступных узлов.  
- Балансировка — простой upstream round‑robin Nginx без sticky‑sessions.  
- Проект предназначен для локального/учебного использования; настройки безопасности минимальные и демонстрационные.  
- Dev и Prod окружения различаются Docker‑оверхедами и конфигами PHP/Nginx.

## 11. Качество, безопасность, эксплуатация
- Качество: обязательные unit/integration тесты, сбор покрытия (HTML отчет).  
- Безопасность: базовый CORS, валидация входных данных, строгие ответы об ошибках, HTTPS вне scope (зависит от окружения).  
- Эксплуатация: Makefile команды для сборки/запуска/логов; окружения в env/.  
- Наблюдаемость: endpoint /api/status и логи контейнеров.

## 12. Метрики успеха
- Технические:  
  - Успешная сборка dev/prod окружений с первого запуска.  
  - 100% прохождение тестов в CI/локально.  
  - Доступность /api/status и корректные статусы Redis Cluster.  
  - Пропускная способность при балансировке (демонстрационно) без ошибок сессий.
- Продуктовые:  
  - Понятность кода и документации для студента/ревьюера.  
  - Возможность расширения функционала без ломки структуры.

## 13. Дорожная карта (рекомендации)
- v1 (текущая): базовая функциональность, тесты, балансировка, Redis Cluster.  
- v1.1: базовые метрики (простейшие Prometheus/NGINX logs парсинг), docker healthchecks.  
- v1.2: E2E тесты фронтенда (например, Playwright/Vitest).  
- v2.0: авторизация (например, Laravel Sanctum или собственный middleware), расширение API (история проверок), prod HTTPS‑прокси.  

## 14. Заинтересованные стороны
- Автор/мейнтейнер: Vladimir Matkovskii — vlavlamat@icloud.com  
- Студенты/пользователи: разработчики, изучающие стек.  
- Ревьюеры/преподаватели: оценивают архитектуру и качество решения.

## 15. Глоссарий
- «Кворум Redis Cluster» — минимальное число доступных узлов для признания кластера «connected».  
- «Preflight» — предварительный CORS‑запрос OPTIONS.  
- «PCOV» — расширение для сбора покрытия кода PHP.  
- «Round‑robin» — стратегия балансировки, когда запросы равномерно распределяются по узлам.

## 16. Ссылки
- README.md — подробности по запуску, структуре, стеку и API.  
- docs/overview/requirements.md — функциональные/нефункциональные требования (заполнить при необходимости).  
- docs/overview/user-flow.md — пользовательские сценарии (заполнить при необходимости).  
